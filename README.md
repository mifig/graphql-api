# ğŸ’ RAILS API + ğŸ•¸ï¸ GRAPHQL
<span style="background: rgba(100, 120, 100); border-radius: 10px; padding: 8px 12px;">***v0.1** - 20.08.2024*</span> 

This project aims at providing detailed guidelines to create a Rails API with GraphQL.

It will cover the following sections:

1. Rails API creation
2. GraphQL setup
3. GraphQL types & Active Record Models
4. GraphQL relations
5. GrapgQL resolvers
6. GraphQL mutations
7. Authentication with JWT in a Rails API + GraphQL context

> ğŸš¨ This tutorial assumes a basic knowledge of graphQL operations. Refer to [this tutorial](https://www.youtube.com/playlist?list=PL4cUxeGkcC9gUxtblNUahcsg0WLxmrK_y) to gain an understanding of graphQL before jumping to this project. It should take approximately 2 hours.

**ğŸ”” Note** 
This project uses the following software versions:
- `Ruby`: 3.1.2p20
- `Rails`: 7.1.3.4
- `GraphQL`: 2.3.14

## 1. Rails API creation

Creation of Rails API with postgresql DB:
```sh
rails new NAMEOFAPP --api -d postgresql
```

## 2. GraphQL setup

Add graphql gem to your `gemfile.rb`:
```ruby
gem 'graphql'
```

Install the gem through the terminal:
```sh
bundle install
```

Run the graphql installer that will generate the endpoint of your graphql (in /graphql, check the `routes.rb`) through the terminal:
```sh
rails generate graphql:install
```

Create beforehand the folder structures that will facilitate the organization of a graphql project, with a clear separation of concerns. In `app` > `graphql`:
1. Create a folder `resolvers`;
2. Inside the `resolvers` folder, create the file `base_resolver.rb`:
  ```ruby
  module Resolvers
    class BaseResolver < GraphQL::Schema::Resolver
    end
  end
  ```
3. Inside the `types` folder, create the folders:
  - `models` (where all the types related to your Active Record models will live)
  - `enums` (where all the enums relative to Active Record enums will live)
  - `inputs` (where all the inputs for the mutations will live)

<br>

### Final folder structure
Your folder structure should now look like this (*of course, all the files and folders automatically generated by the graphql installer will also be there*):
- `app`
  - `graphql`
    - `mutations`
    - `resolvers`
    - `types`
      - `enums`
      - `inputs`
      - `models`

## 3. GraphQL types & Active Record Models
Before jumping to graphQL, start by creating the DB, some models and seeds so that we can quickstart our project.

### Generate Active Record models:
These 3 models will ensure we also understand how to manage relations between models in GraphQL.
```sh
rails g model user first_name last_name email
```
```sh
rails g model blog title description:text user:references
```
```sh
rails g model review content:text user:references blog:references
```

#### User Model
Add in the `user.rb` model the reviews and blogs associations:
```ruby
class User < ApplicationRecord
  has_many :blogs, dependent: :destroy
  has_many :reviews, dependent: :destroy
  
  before_save { self.email = email.downcase }

  def full_name
    "#{first_name} #{last_name}"
  end
end
```

#### Blog Model
Add in the `user.rb` model the reviews and blogs associations:
```ruby
class Blog < ApplicationRecord
  belongs_to :user
  has_many :reviews, dependent: :destroy
end
```

#### Review Model
The review model you don't need to alter, as it comes already with the correct associations to both user and blog models, created automatically when the rails generator was ran for the review model.

### Create some Seeds:
Now generate some seeds in the `seeds.rb` file so that we have some data to test our implementations (you can use the `faker` gem):
```ruby
User.destroy_all
Blog.destroy_all
Review.destroy_all

5.times do
  first_name = Faker::Name.first_name
  User.create!(first_name:, last_name: Faker::Name.last_name, email: "#{first_name}@test.com")
end

20.times do
  Blog.create!(title: Faker::Book.title, description: Faker::Lorem.paragraphs(number: 3), user: User.find(User.ids.sample))
end

30.times do 
  Review.create!(content: Faker::GreekPhilosophers.quote, user: User.find(User.ids.sample), blog: Blog.find(Blog.ids.sample))
end
```

### Create your DB
Now create, migrate and run the seeds in the terminal:
```sh
rails db:create db:migrate db:seed
```

Your DB is now setup.

## 4. GraphQL relations
## 5. GrapgQL resolvers
## 6. GraphQL mutations
## 7. Authentication with JWT in a Rails API + GraphQL context